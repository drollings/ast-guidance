{
  "meta": {
    "module": "src.ast-guidance.tests",
    "source": "src/ast-guidance/tests.zig",
    "language": "zig"
  },
  "comment": "[gof-patterns] Tests JSON store merge, query engine behavior, and local time handling in Guidance.",
  "skills": [
    { "ref": ".ast-guidance/.skills/gof-patterns/SKILL.md", "context": "GoF patterns detected" }
  ],
  "used_by": ["src/ast-guidance/main.zig"],
  "members": [
    {
      "type": "test_decl",
      "name": "parseHunkRanges returns empty for non-hunk input",
      "is_pub": false,
      "line": 16
    },
    {
      "type": "test_decl",
      "name": "parseHunkRanges parses single @@ header",
      "is_pub": false,
      "line": 27
    },
    {
      "type": "test_decl",
      "name": "parseHunkRanges parses multiple @@ headers",
      "is_pub": false,
      "line": 41
    },
    {
      "type": "test_decl",
      "name": "parseHunkRanges handles @@ without count (implicit 1)",
      "is_pub": false,
      "line": 65
    },
    {
      "type": "test_decl",
      "name": "loadChangedMembers returns empty for missing JSON file",
      "is_pub": false,
      "line": 84
    },
    {
      "type": "test_decl",
      "name": "loadChangedMembers returns all members when hunk_ranges is empty",
      "is_pub": false,
      "line": 102
    },
    {
      "type": "test_decl",
      "name": "loadChangedMembers filters by hunk range with context window",
      "is_pub": false,
      "line": 146
    },
    {
      "type": "test_decl",
      "name": "getLocalTime returns valid ranges",
      "is_pub": false,
      "line": 191
    },
    {
      "type": "test_decl",
      "name": "classifyBulletKeyword returns path under skills_dir",
      "is_pub": false,
      "line": 214
    },
    {
      "type": "fn_private",
      "name": "makeMember",
      "match_hash": "b60c40782f5a498acdb9cda7acf9f90081c7208f806770e41ddeeaa362bce2d5",
      "signature": "fn makeMember(name: []const u8, hash: ?[]const u8, doc: ?[]const u8) -> types.Member",
      "params": [
        { "name": "name", "type": "[]const u8" },
        { "name": "hash", "type": "?[]const u8" },
        { "name": "doc", "type": "?[]const u8" }
      ],
      "returns": "types.Member",
      "patterns": [
        { "name": "Factory (GoF)", "type": "GoF", "ref": "guidance/skills/gof-patterns/SKILL.md#factory" }
      ],
      "is_pub": false,
      "line": 249
    },
    {
      "type": "test_decl",
      "name": "dupeMember produces independent copies",
      "is_pub": false,
      "line": 262
    },
    {
      "type": "test_decl",
      "name": "dupeMember with params",
      "is_pub": false,
      "line": 296
    },
    {
      "type": "test_decl",
      "name": "dupeMember with nested members",
      "is_pub": false,
      "line": 326
    },
    {
      "type": "test_decl",
      "name": "mergeMembers with no existing produces all new members",
      "is_pub": false,
      "line": 356
    },
    {
      "type": "test_decl",
      "name": "mergeMembers preserves comment when hash unchanged",
      "is_pub": false,
      "line": 382
    },
    {
      "type": "test_decl",
      "name": "mergeMembers counts update when hash changed",
      "is_pub": false,
      "line": 409
    },
    {
      "type": "test_decl",
      "name": "mergeMembers counts removed members",
      "is_pub": false,
      "line": 433
    },
    {
      "type": "test_decl",
      "name": "mergeMembers no changes when source matches existing exactly",
      "is_pub": false,
      "line": 461
    },
    {
      "type": "test_decl",
      "name": "mergeMembers clears stale comment when hash changes",
      "is_pub": false,
      "line": 487
    },
    {
      "type": "test_decl",
      "name": "mergeMembers preserves tags when hash unchanged",
      "is_pub": false,
      "line": 515
    },
    {
      "type": "test_decl",
      "name": "freeGuidanceDoc frees all fields without double-free",
      "is_pub": false,
      "line": 544
    },
    {
      "type": "test_decl",
      "name": "dupeSkills produces independent copies",
      "is_pub": false,
      "line": 571
    },
    {
      "type": "test_decl",
      "name": "mergeMembers result is independent after source freed",
      "is_pub": false,
      "line": 604
    },
    {
      "type": "test_decl",
      "name": "mergeMembers result is independent after existing freed",
      "is_pub": false,
      "line": 640
    },
    {
      "type": "fn_private",
      "name": "writeTempGuidance",
      "match_hash": "5ac17250e2bf3840b2edec34110a8d12b1c9c3f0be5ecc14bb92d97e772a7519",
      "signature": "fn writeTempGuidance(allocator: std.mem.Allocator, dir_path: []const u8, filename: []const u8, module: []const u8) -> []u8",
      "params": [
        { "name": "allocator", "type": "std.mem.Allocator" },
        { "name": "dir_path", "type": "[]const u8" },
        { "name": "filename", "type": "[]const u8" },
        { "name": "module", "type": "[]const u8" }
      ],
      "returns": "[]u8",
      "is_pub": false,
      "line": 688
    },
    {
      "type": "test_decl",
      "name": "QueryEngine.execute no leaks with empty query results",
      "is_pub": false,
      "line": 713
    },
    {
      "type": "fn_private",
      "name": "writeGuidanceJson",
      "match_hash": "5c11d6de5766ea3e674e135ed080b2e59fc12958e917c25fa40cb12febc09774",
      "signature": "fn writeGuidanceJson(dir: std.fs.Dir, filename: []const u8, comment: ?[]const u8, has_member: bool) -> void",
      "params": [
        { "name": "dir", "type": "std.fs.Dir" },
        { "name": "filename", "type": "[]const u8" },
        { "name": "comment", "type": "?[]const u8" },
        { "name": "has_member", "type": "bool" }
      ],
      "returns": "void",
      "is_pub": false,
      "line": 744
    },
    {
      "type": "test_decl",
      "name": "infillJsonFile returns false when no enhancer configured",
      "is_pub": false,
      "line": 764
    },
    {
      "type": "test_decl",
      "name": "infillJsonFile returns false when no infill/regen flag set",
      "is_pub": false,
      "line": 788
    },
    {
      "type": "test_decl",
      "name": "infillJsonFile returns false for nonexistent path",
      "is_pub": false,
      "line": 811
    },
    {
      "type": "test_decl",
      "name": "infillAllJson returns 0 when no enhancer configured",
      "is_pub": false,
      "line": 834
    },
    {
      "type": "test_decl",
      "name": "infillAllJson returns 0 when cross-language flags not set",
      "is_pub": false,
      "line": 858
    },
    {
      "type": "test_decl",
      "name": "infillAllJson skips files in skip_paths",
      "is_pub": false,
      "line": 882
    },
    {
      "type": "test_decl",
      "name": "infillAllJson ignores non-json files",
      "is_pub": false,
      "line": 910
    },
    {
      "type": "test_decl",
      "name": "infillAllJson processes .py.json files alongside .zig.json files",
      "is_pub": false,
      "line": 937
    },
    {
      "type": "test_decl",
      "name": "freeQueryResult handles all empty slices",
      "is_pub": false,
      "line": 964
    },
    {
      "type": "test_decl",
      "name": "freeQueryResult frees FileMatch strings",
      "is_pub": false,
      "line": 986
    },
    {
      "type": "test_decl",
      "name": "freeQueryResult frees GuidanceInfo strings and slices",
      "is_pub": false,
      "line": 1023
    },
    {
      "type": "test_decl",
      "name": "QueryEngine deinit with no execute is safe",
      "is_pub": false,
      "line": 1060
    },
    {
      "type": "test_decl",
      "name": "loadConfig falls back to built-in defaults when no config file exists",
      "is_pub": false,
      "line": 1082
    },
    {
      "type": "test_decl",
      "name": "loadConfig deinit releases all memory (no leaks)",
      "is_pub": false,
      "line": 1125
    },
    {
      "type": "test_decl",
      "name": "loadConfig reads guidance_dir from project config JSON",
      "is_pub": false,
      "line": 1142
    },
    {
      "type": "test_decl",
      "name": "loadConfig reads src_dirs array from JSON",
      "is_pub": false,
      "line": 1169
    },
    {
      "type": "test_decl",
      "name": "loadConfig reads models.infill as model",
      "is_pub": false,
      "line": 1196
    },
    {
      "type": "test_decl",
      "name": "loadConfig falls back to models.default when infill absent",
      "is_pub": false,
      "line": 1221
    },
    {
      "type": "test_decl",
      "name": "loadConfig constructs api_url from ollama base_url and chat_endpoint",
      "is_pub": false,
      "line": 1245
    },
    {
      "type": "test_decl",
      "name": "loadConfig with invalid JSON falls back to defaults",
      "is_pub": false,
      "line": 1269
    },
    {
      "type": "fn_private",
      "name": "writeInboxFile",
      "match_hash": "6c65ce258d32e24ad6de3934c509ea69e99256212afa6894b4921400ebe9eaee",
      "signature": "fn writeInboxFile(allocator: std.mem.Allocator, dir: std.fs.Dir, dir_path: []const u8, filename: []const u8, content: []const u8) -> []u8",
      "params": [
        { "name": "allocator", "type": "std.mem.Allocator" },
        { "name": "dir", "type": "std.fs.Dir" },
        { "name": "dir_path", "type": "[]const u8" },
        { "name": "filename", "type": "[]const u8" },
        { "name": "content", "type": "[]const u8" }
      ],
      "returns": "[]u8",
      "is_pub": false,
      "line": 1296
    },
    {
      "type": "test_decl",
      "name": "readInboxBullets returns empty slice for missing file",
      "is_pub": false,
      "line": 1305
    },
    {
      "type": "test_decl",
      "name": "readInboxBullets returns matching bullets and skips non-matching",
      "is_pub": false,
      "line": 1331
    },
    {
      "type": "test_decl",
      "name": "readInboxBullets skips heading lines",
      "is_pub": false,
      "line": 1370
    },
    {
      "type": "test_decl",
      "name": "chunkIsIgnored: .ast-guidance/ prefix is filtered",
      "is_pub": false,
      "line": 1416
    },
    {
      "type": "test_decl",
      "name": "chunkIsIgnored: guidance/ prefix is NOT filtered (regression guard)",
      "is_pub": false,
      "line": 1427
    },
    {
      "type": "test_decl",
      "name": "chunkIsIgnored: regular source files are not filtered",
      "is_pub": false,
      "line": 1440
    },
    {
      "type": "test_decl",
      "name": "chunkFilePath: extracts path from diff --git header",
      "is_pub": false,
      "line": 1460
    },
    {
      "type": "test_decl",
      "name": "chunkFilePath: returns empty string for malformed chunk",
      "is_pub": false,
      "line": 1469
    },
    {
      "type": "test_decl",
      "name": "splitDiffByFile: single file diff produces one chunk",
      "is_pub": false,
      "line": 1474
    },
    {
      "type": "test_decl",
      "name": "splitDiffByFile: multi-file diff splits into correct chunks",
      "is_pub": false,
      "line": 1496
    },
    {
      "type": "test_decl",
      "name": "splitDiffByFile: .ast-guidance/ chunks split correctly and are identifiable",
      "is_pub": false,
      "line": 1524
    },
    {
      "type": "test_decl",
      "name": "QueryEngine.execute finds guidance JSON matching query",
      "is_pub": false,
      "line": 1554
    }
  ]
}
